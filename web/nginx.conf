server {
  listen 80;
  
  # Serve API requests - handle all /api requests through PHP
  location ^~ /api {
      fastcgi_pass examan-api:9000;
      include fastcgi_params;
      fastcgi_param SCRIPT_FILENAME /var/www/html/public/index.php;
      fastcgi_param REQUEST_URI $request_uri;
      fastcgi_param QUERY_STRING $query_string;
      fastcgi_connect_timeout 1000s;
      fastcgi_read_timeout 1000s;
      fastcgi_buffers 256 400k;
      client_max_body_size 100M;
  }

  # Serve PHP application static assets (bundles, etc.)
  location ^~ /bundles/ {
      root /var/www/html/public;
      expires 1y;
      add_header Cache-Control "public, immutable";
      try_files $uri =404;
  }

  # Serve frontend static files
  location / {
      root /var/www/frontend/dist;
      try_files $uri $uri/ /index.html;
      
      # Handle static assets with caching
      location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
          expires 1y;
          add_header Cache-Control "public, immutable";
      }
  }
}
